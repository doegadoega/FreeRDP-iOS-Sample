# AI セーフティガイドライン 🛡️

## 🚨 最重要ルール：事前承認が必要な変更

### 🔒 **絶対に事前承認なしで変更してはいけない項目**

#### 1. ライブラリ・依存関係のバージョン
```bash
# build.sh内の以下の項目は事前承認必須
FREERDP_VERSION="3.15.0"     # ❌ 勝手に変更禁止
OPENSSL_VERSION="3.4.0"      # ❌ 勝手に変更禁止

# Podfileの依存関係
# ❌ バージョン指定の変更は事前承認必須
```

#### 2. ビルド設定・環境設定
- `project.yml` の主要設定
- `build.sh` のコンパイル設定
- `Podfile` の依存関係
- iOS Target バージョン

#### 3. 既存の動作している機能
- 既に動作確認済みのコード
- テスト済みの設定
- 実証済みの実装

## 📋 AIセッション開始時の必須チェック

### Phase 0: セーフティチェック（5分）
1. **現在の安定バージョン確認**
   ```bash
   # 現在のライブラリバージョンを記録
   grep "VERSION=" build.sh
   cat Podfile | grep -E "pod.*,"
   ```

2. **最新の制限事項確認**
   - `docs/AI_SAFETY_GUIDELINES.md`（このファイル）を必読
   - `docs/development-logs/INDEX.md` で未解決課題確認
   - 前回セッションでの警告事項確認

3. **変更予定の事前申告**
   ```markdown
   ## 本セッションで変更予定の項目
   - [ ] コード修正のみ（バージョン変更なし）
   - [ ] 設定ファイル修正（要承認）
   - [ ] ライブラリ更新（要明示的承認）
   - [ ] 新機能追加（影響範囲確認必要）
   ```

## 📋 AIセッション終了時の必須チェック

### Phase 1: 作業レポート作成（必須）
1. **development-logsファイル作成**
   ```bash
   # 現在時刻でファイル名決定
   date '+%Y%m%d-%H%M'
   # docs/development-logs/[YYYYMMDD-HHMM].md を作成
   ```

2. **必須記録項目の完全記述**
   - [ ] セッション基本情報（AI、時刻、指示者、状況）
   - [ ] 受けた指示（原文そのまま）
   - [ ] 作業時系列（時刻付き詳細）
   - [ ] ファイル操作履歴（新規・更新・削除）
   - [ ] エラー内容と解決方法
   - [ ] 次回セッションへの引き継ぎ事項

3. **品質確保チェック**
   - [ ] 他の人が作業を再現できるレベルの詳細度
   - [ ] 意思決定の根拠が明確
   - [ ] 次回AIセッションが5分で開始できる情報

### Phase 2: コミット実行
1. **ファイル順序の遵守**
   ```bash
   # 1. 作業レポートを最初に追加
   git add docs/development-logs/[YYYYMMDD-HHMM].md
   
   # 2. 他の変更ファイルを追加
   git add [変更ファイル...]
   
   # 3. 適切なコミットメッセージでコミット
   git commit -m "[種別]: [要約] - [詳細]"
   ```

2. **INDEXファイル更新**
   - `docs/development-logs/INDEX.md` に新セッション追加
   - 統計情報とタグ索引の更新

## 🚫 禁止行動リスト

### ❌ **絶対禁止**
1. **ライブラリバージョンの独断変更**
2. **動作している機能の大幅リファクタリング**
3. **依存関係の追加・削除（事前相談なし）**
4. **ビルド設定の根本的変更**
5. **既存テストの削除**

### ⚠️ **要注意（必ず相談）**
1. **新しいライブラリの導入**
2. **アーキテクチャの変更**
3. **プロジェクト構造の変更**
4. **iOS対応バージョンの変更**

## ✅ 安全な作業範囲

### 🟢 **事前承認不要（推奨）**
1. **バグ修正（既存機能の維持）**
2. **コメント・ドキュメントの追加**
3. **ログ・デバッグ情報の追加**
4. **UI表示の微調整**
5. **エラーハンドリングの改善**

### 🟡 **注意深く実施（影響確認必要）**
1. **新機能の追加**
2. **パフォーマンス最適化**
3. **コード構造の改善**

## 🔄 変更提案のプロセス

### ライブラリ更新が必要な場合
```markdown
## ライブラリ更新提案

### 現在のバージョン
- OpenSSL: 3.4.0
- FreeRDP: 3.15.0

### 提案するバージョン
- OpenSSL: X.X.X
- FreeRDP: X.X.X

### 更新理由
- [ ] セキュリティ修正
- [ ] 重大バグ修正  
- [ ] 必須新機能
- [ ] 互換性問題

### 影響分析
- [ ] ビルド影響: あり/なし
- [ ] 既存機能影響: あり/なし
- [ ] パフォーマンス影響: あり/なし

### テスト計画
- [ ] ビルドテスト
- [ ] 基本機能テスト
- [ ] 回帰テスト

**❗ 明示的な承認を得てから実行**
```

## 🧪 デグレード防止策

### 1. 変更前のベースライン記録
```bash
# セッション開始時に現在の状態を記録
git status > session_start_status.txt
./build.sh xcode 2>&1 | tee build_baseline.log
```

### 2. 段階的変更アプローチ
- 一度に複数の変更を行わない
- 各変更後にビルド確認
- 問題発生時の即座回復

### 3. 変更影響の明確化
```markdown
## 変更影響分析テンプレート

### 変更内容
- 変更ファイル: 
- 変更理由:
- 期待する効果:

### 影響範囲
- [ ] ビルドプロセス
- [ ] 実行時動作  
- [ ] 依存関係
- [ ] 互換性

### 検証方法
- [ ] ビルド成功確認
- [ ] 基本動作確認
- [ ] 既存機能維持確認

### 回復手順（問題発生時）
```

## 📞 エスカレーション基準

### 即座にユーザーに相談が必要な状況
1. **ビルドエラーが解決できない**（30分以上）
2. **既存機能が動作しなくなった**
3. **ライブラリ更新が必要と判断した場合**
4. **プロジェクト構造変更が必要な場合**
5. **予期しない重大な問題が発生**

### 相談時の報告フォーマット
```markdown
## 🚨 エスカレーション報告

### 状況
- 発生時刻:
- 作業内容:
- エラー内容:

### 試行した解決策
1. 
2. 
3. 

### 提案する対策
- オプションA:
- オプションB:
- 推奨オプション:

### 承認が必要な変更
- [ ] ライブラリバージョン変更
- [ ] 設定ファイル変更
- [ ] アーキテクチャ変更
- [ ] その他:
```

## 🎯 成功基準

### セッション成功の条件
- [ ] ビルドが通る（同等またはそれ以上）
- [ ] 既存機能が動作する
- [ ] 新機能が期待通り動作する
- [ ] パフォーマンスが悪化していない
- [ ] 依存関係が壊れていない

---

## 📌 このガイドラインの更新ルール

1. **重大な問題発生時**: このガイドラインを見直し
2. **プロジェクト成長時**: 制約の調整
3. **ユーザー要求時**: 優先度の見直し

**このガイドラインは、プロジェクトの安定性とユーザーの意図を最優先にしています**

---

**最終更新**: 2025/05/24  
**重要度**: 🔴 最重要（全AIセッションで必須遵守）  
**策定者**: AI Assistant + User Safety Requirements 